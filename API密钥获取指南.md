# APIå¯†é’¥è·å–æŒ‡å—

## ğŸ“‹ æ¦‚è§ˆ

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ è·å–ä»¥ä¸‹æœåŠ¡çš„APIå¯†é’¥/å‡­æ®ï¼š

- âœ… **Notion** - çŸ¥è¯†åº“ç®¡ç†ï¼ˆæœ€ç®€å•ï¼Œ5åˆ†é’Ÿï¼‰
- âœ… **Google Calendar** - æ—¥ç¨‹ç®¡ç†ï¼ˆéœ€è¦OAuth2ï¼Œ15åˆ†é’Ÿï¼‰
- âœ… **Gmail** - é‚®ä»¶å¤„ç†ï¼ˆä¸Calendarå…±ç”¨å‡­æ®ï¼‰

---

## ğŸ¯ ä¼˜å…ˆçº§æ¨è

### ç¬¬1æ­¥ï¼šå…ˆé…ç½® Notionï¼ˆæœ€ç®€å•ï¼‰â­â­â­â­â­
**æ—¶é—´**: 5åˆ†é’Ÿ
**éš¾åº¦**: â­ æç®€å•
**æ•ˆæœ**: çŸ¥è¯†åº“ç®¡ç†ã€ç¬”è®°è‡ªåŠ¨åŒ–

### ç¬¬2æ­¥ï¼šå†é…ç½® GoogleæœåŠ¡ï¼ˆCalendar + Gmailï¼‰â­â­â­â­
**æ—¶é—´**: 15åˆ†é’Ÿ
**éš¾åº¦**: â­â­ ç¨å¤æ‚ï¼ˆéœ€è¦åˆ›å»ºGoogle Cloudé¡¹ç›®ï¼‰
**æ•ˆæœ**: æ—¥ç¨‹ç®¡ç† + é‚®ä»¶è‡ªåŠ¨åŒ–

---

## 1ï¸âƒ£ Notion API Token è·å–ï¼ˆæ¨èå…ˆåšï¼‰

### æ­¥éª¤1ï¼šåˆ›å»ºIntegration

1. è®¿é—® **Notion Integrations** é¡µé¢ï¼š
   https://www.notion.so/my-integrations

2. ç‚¹å‡» **"+ New integration"** æŒ‰é’®

3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Name**: Personal Chatbox Agentï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - **Logo**: å¯é€‰
   - **Associated workspace**: é€‰æ‹©ä½ çš„å·¥ä½œåŒº
   - **Type**: Internalï¼ˆå†…éƒ¨é›†æˆï¼‰
   - **Capabilities**: å‹¾é€‰ä»¥ä¸‹æƒé™ï¼š
     - âœ… Read content
     - âœ… Update content
     - âœ… Insert content
     - âœ… Read user informationï¼ˆå¯é€‰ï¼‰

4. ç‚¹å‡» **"Submit"** åˆ›å»º

5. å¤åˆ¶æ˜¾ç¤ºçš„ **Internal Integration Token**
   æ ¼å¼ç±»ä¼¼ï¼š`secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### æ­¥éª¤2ï¼šåˆ†äº«é¡µé¢ç»™Integration

âš ï¸ **é‡è¦**ï¼šåˆ›å»ºIntegrationåï¼Œå¿…é¡»å°†Notioné¡µé¢åˆ†äº«ç»™å®ƒï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼

1. æ‰“å¼€ä½ æƒ³è®©AIè®¿é—®çš„Notioné¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’çš„ **"Share"** æŒ‰é’®
3. åœ¨ **"Invite"** æœç´¢æ¡†ä¸­è¾“å…¥ä½ åˆšåˆ›å»ºçš„Integrationåç§°
4. ç‚¹å‡» **"Invite"** æ·»åŠ Integration

### æ­¥éª¤3ï¼šé…ç½®åˆ°é¡¹ç›®

#### æ–¹æ³•Aï¼šé€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæˆ–ç¼–è¾‘ .env æ–‡ä»¶
echo 'NOTION_API_KEY=secret_ä½ çš„Token' >> .env
```

#### æ–¹æ³•Bï¼šé€šè¿‡å‰ç«¯è®¾ç½®é¡µé¢

1. å¯åŠ¨é¡¹ç›®åè®¿é—®å‰ç«¯
2. è¿›å…¥ **è®¾ç½® â†’ æœåŠ¡ç®¡ç†**
3. æ‰¾åˆ° **NotionçŸ¥è¯†ç®¡ç†** æœåŠ¡
4. ç‚¹å‡» **"é…ç½®"** æŒ‰é’®
5. ç²˜è´´ä½ çš„Integration Token
6. ç‚¹å‡» **"ä¿å­˜"** å¹¶å¯ç”¨æœåŠ¡

### æµ‹è¯•Notionè¿æ¥

åœ¨å‰ç«¯å¯¹è¯æ¡†æµ‹è¯•ï¼š

```
"åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡µé¢ï¼Œæ ‡é¢˜æ˜¯'AIæµ‹è¯•ç¬”è®°'"
"åˆ—å‡ºæˆ‘Notionä¸­çš„æ‰€æœ‰é¡µé¢"
"æœç´¢Notionä¸­åŒ…å«'AI'çš„å†…å®¹"
```

---

## 2ï¸âƒ£ Google Calendar & Gmail OAuth2 å‡­æ®è·å–

### ä¸ºä»€ä¹ˆéœ€è¦OAuth2ï¼Ÿ

Gmailå’ŒGoogle Calendaréœ€è¦OAuth2è®¤è¯æ¥ä¿æŠ¤ä½ çš„éšç§ã€‚ä¸€æ¬¡é…ç½®å¯ä»¥åŒæ—¶ç”¨äºä¸¤ä¸ªæœåŠ¡ã€‚

### æ­¥éª¤1ï¼šåˆ›å»ºGoogle Cloudé¡¹ç›®

1. è®¿é—® **Google Cloud Console**ï¼š
   https://console.cloud.google.com/

2. ç‚¹å‡»é¡¶éƒ¨çš„ **"é€‰æ‹©é¡¹ç›®"** â†’ **"æ–°å»ºé¡¹ç›®"**

3. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **é¡¹ç›®åç§°**: Personal-Chatboxï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - **ç»„ç»‡**: æ— ï¼ˆä¸ªäººä½¿ç”¨ï¼‰

4. ç‚¹å‡» **"åˆ›å»º"**

### æ­¥éª¤2ï¼šå¯ç”¨API

#### å¯ç”¨ Gmail API

1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **"APIå’ŒæœåŠ¡"** â†’ **"åº“"**
2. æœç´¢ **"Gmail API"**
3. ç‚¹å‡»è¿›å…¥ï¼Œç„¶åç‚¹å‡» **"å¯ç”¨"**

#### å¯ç”¨ Google Calendar API

1. è¿”å›APIåº“
2. æœç´¢ **"Google Calendar API"**
3. ç‚¹å‡»è¿›å…¥ï¼Œç„¶åç‚¹å‡» **"å¯ç”¨"**

### æ­¥éª¤3ï¼šåˆ›å»ºOAuth2å‡­æ®

1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **"APIå’ŒæœåŠ¡"** â†’ **"å‡­æ®"**

2. ç‚¹å‡»é¡¶éƒ¨çš„ **"+ åˆ›å»ºå‡­æ®"** â†’ **"OAuth å®¢æˆ·ç«¯ ID"**

3. å¦‚æœæç¤ºé…ç½®åŒæ„å±å¹•ï¼Œç‚¹å‡» **"é…ç½®åŒæ„å±å¹•"**ï¼š
   - **ç”¨æˆ·ç±»å‹**: é€‰æ‹© **"å¤–éƒ¨"**ï¼ˆä¸ªäººä½¿ç”¨ï¼‰
   - **åº”ç”¨åç§°**: Personal Chatbox
   - **ç”¨æˆ·æ”¯æŒç”µå­é‚®ä»¶**: ä½ çš„Gmailåœ°å€
   - **å¼€å‘è€…è”ç³»ä¿¡æ¯**: ä½ çš„Gmailåœ°å€
   - **èŒƒå›´**: ä¸ç”¨æ·»åŠ ï¼ˆç¨åä¼šè‡ªåŠ¨æ·»åŠ ï¼‰
   - **æµ‹è¯•ç”¨æˆ·**: æ·»åŠ ä½ è‡ªå·±çš„Gmailåœ°å€
   - ç‚¹å‡» **"ä¿å­˜å¹¶ç»§ç»­"** ç›´åˆ°å®Œæˆ

4. è¿”å›åˆ›å»ºOAuthå®¢æˆ·ç«¯IDï¼š
   - **åº”ç”¨ç±»å‹**: é€‰æ‹© **"æ¡Œé¢åº”ç”¨"**
   - **åç§°**: Personal Chatbox Desktop Client
   - ç‚¹å‡» **"åˆ›å»º"**

5. å¼¹å‡ºçª—å£ä¼šæ˜¾ç¤º **"å®¢æˆ·ç«¯ID"** å’Œ **"å®¢æˆ·ç«¯å¯†é’¥"**

6. ç‚¹å‡» **"ä¸‹è½½JSON"** æŒ‰é’®ï¼Œä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°
   æ–‡ä»¶åç±»ä¼¼ï¼š`client_secret_xxxxxx.json`

### æ­¥éª¤4ï¼šé…ç½®OAuth2å‡­æ®

#### æ–¹æ³•Aï¼šé€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
# å‡è®¾ä½ ä¸‹è½½çš„æ–‡ä»¶æ˜¯ client_secret.json
# å°†JSONå†…å®¹è®¾ç½®ä¸ºç¯å¢ƒå˜é‡

# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæˆ–ç¼–è¾‘ .env æ–‡ä»¶
echo 'GOOGLE_CALENDAR_CREDENTIALS=$(cat path/to/client_secret.json)' >> .env
echo 'GMAIL_CREDENTIALS=$(cat path/to/client_secret.json)' >> .env
```

#### æ–¹æ³•Bï¼šé€šè¿‡é…ç½®æ–‡ä»¶

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º google_credentials ç›®å½•
mkdir -p google_credentials

# å¤åˆ¶ä¸‹è½½çš„JSONæ–‡ä»¶
cp ~/Downloads/client_secret_*.json google_credentials/client_secret.json
```

ç„¶åä¿®æ”¹ `server/config.cjs`ï¼š

```javascript
// Google Calendar é…ç½®
google_calendar: {
  // ...å…¶ä»–é…ç½®
  env: {
    GOOGLE_CALENDAR_CREDENTIALS: require('fs').readFileSync(
      require('path').join(process.cwd(), 'google_credentials', 'client_secret.json'),
      'utf8'
    )
  }
},

// Gmail é…ç½®
gmail: {
  // ...å…¶ä»–é…ç½®
  env: {
    GMAIL_CREDENTIALS: require('fs').readFileSync(
      require('path').join(process.cwd(), 'google_credentials', 'client_secret.json'),
      'utf8'
    )
  }
}
```

### æ­¥éª¤5ï¼šé¦–æ¬¡æˆæƒ

é…ç½®å¥½å‡­æ®åï¼Œ**é¦–æ¬¡ä½¿ç”¨**æ—¶éœ€è¦æˆæƒï¼š

1. é‡å¯æœåŠ¡å™¨ï¼š
   ```bash
   pkill -f "node.*server/index.cjs"
   node server/index.cjs
   ```

2. åœ¨å‰ç«¯å¯¹è¯æ¡†ä¸­æµ‹è¯•ï¼š
   ```
   "æŸ¥çœ‹æˆ‘æ˜å¤©çš„æ—¥ç¨‹"
   "æ£€æŸ¥æˆ‘çš„é‚®ä»¶"
   ```

3. ç³»ç»Ÿä¼šå¼¹å‡ºæˆæƒé¡µé¢ï¼ˆæˆ–åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºæˆæƒURLï¼‰

4. è®¿é—®æˆæƒURLï¼Œç™»å½•ä½ çš„Googleè´¦å·

5. å…è®¸åº”ç”¨è®¿é—®ä½ çš„Gmailå’ŒCalendar

6. æˆæƒæˆåŠŸåï¼Œå‡­æ®ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¹‹åæ— éœ€å†æ¬¡æˆæƒ

### æµ‹è¯•GoogleæœåŠ¡

åœ¨å‰ç«¯å¯¹è¯æ¡†æµ‹è¯•ï¼š

```
ğŸ“… Google Calendaræµ‹è¯•:
"æˆ‘æ˜å¤©æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ"
"åœ¨æ˜å¤©ä¸‹åˆ3ç‚¹åˆ›å»ºä¸€ä¸ªä¼šè®®ï¼šè®¨è®ºé¡¹ç›®è¿›å±•"
"è¿™å‘¨æœ‰å‡ ä¸ªä¼šè®®ï¼Ÿ"

ğŸ“§ Gmailæµ‹è¯•:
"æ€»ç»“æˆ‘æœ€è¿‘çš„é‚®ä»¶"
"æœ‰æ²¡æœ‰å…³äºé¡¹ç›®çš„é‡è¦é‚®ä»¶ï¼Ÿ"
"ç»™å¼ ä¸‰å‘ä¸€å°é‚®ä»¶ï¼Œå‘Šè¯‰ä»–é¡¹ç›®è¿›å±•é¡ºåˆ©"
```

---

## ğŸ“Š æœåŠ¡å¯ç”¨çŠ¶æ€æ£€æŸ¥

é…ç½®å®Œæˆåï¼Œæ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f server-restart.log | grep -E "(å¯åŠ¨æˆåŠŸ|å·¥å…·æ•°é‡|ERROR)"
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… [MCP Manager] youtube_transcript å¯åŠ¨æˆåŠŸ, å·¥å…·æ•°é‡: 1
âœ… [MCP Manager] notion å¯åŠ¨æˆåŠŸ, å·¥å…·æ•°é‡: XX
âœ… [MCP Manager] google_calendar å¯åŠ¨æˆåŠŸ, å·¥å…·æ•°é‡: XX
âœ… [MCP Manager] gmail å¯åŠ¨æˆåŠŸ, å·¥å…·æ•°é‡: XX
```

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•è„šæœ¬

é…ç½®å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

### 1. Notionæµ‹è¯•

```bash
curl -X POST http://localhost:3001/api/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "messages": [{"role": "user", "content": "åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡µé¢"}],
    "stream": false
  }'
```

### 2. Google Calendaræµ‹è¯•

```bash
curl -X POST http://localhost:3001/api/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "messages": [{"role": "user", "content": "æˆ‘æ˜å¤©æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ"}],
    "stream": false
  }'
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: Notionè¿”å› "unauthorized"

**åŸå› **: æ²¡æœ‰å°†é¡µé¢åˆ†äº«ç»™Integration
**è§£å†³**:
1. æ‰“å¼€ä½ çš„Notioné¡µé¢
2. ç‚¹å‡»"Share"
3. æ·»åŠ ä½ çš„Integration
4. é‡è¯•

### Q2: GoogleæœåŠ¡æˆæƒå¤±è´¥

**åŸå› **: OAuth2é…ç½®ä¸æ­£ç¡®
**è§£å†³**:
1. æ£€æŸ¥ `client_secret.json` æ–‡ä»¶æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿åœ¨Google Cloud Consoleä¸­å¯ç”¨äº†å¯¹åº”çš„API
3. ç¡®ä¿æ·»åŠ äº†è‡ªå·±çš„Gmailåœ°å€ä¸ºæµ‹è¯•ç”¨æˆ·

### Q3: æœåŠ¡å¯åŠ¨å¤±è´¥

**åŸå› **: NPMåŒ…ä¸‹è½½é—®é¢˜æˆ–é…ç½®é”™è¯¯
**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æŸ¥çœ‹ `server-restart.log` ä¸­çš„é”™è¯¯ä¿¡æ¯
3. æ‰‹åŠ¨å®‰è£…åŒ…æµ‹è¯•ï¼š
   ```bash
   npx -y @notionhq/client
   npx -y @modelcontextprotocol/server-google-calendar
   npx -y @modelcontextprotocol/server-gmail
   ```

### Q4: OAuth2æˆæƒURLæ²¡æœ‰æ˜¾ç¤º

**åŸå› **: æœåŠ¡å™¨æ—¥å¿—è¾“å‡ºè¢«é‡å®šå‘
**è§£å†³**:
1. ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`tail -f server-restart.log`
2. æˆ–è€…åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`http://localhost:3001/api/auth/google`

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

é…ç½®å®Œæˆåï¼Œä½ çš„ç³»ç»Ÿå°†æ‹¥æœ‰ä»¥ä¸‹èƒ½åŠ›ï¼š

### âœ… YouTube Transcript
- ğŸ¥ æå–YouTubeè§†é¢‘å­—å¹•
- ğŸ“š è§†é¢‘å†…å®¹å­¦ä¹ å’Œæ€»ç»“

### âœ… Notionï¼ˆé…ç½®åï¼‰
- ğŸ“ è‡ªåŠ¨åˆ›å»ºç¬”è®°
- ğŸ—‚ï¸ çŸ¥è¯†åº“ç®¡ç†
- ğŸ” å†…å®¹æœç´¢å’Œæ•´ç†

### âœ… Google Calendarï¼ˆé…ç½®åï¼‰
- ğŸ“… æ™ºèƒ½æ—¥ç¨‹ç®¡ç†
- â° ä¼šè®®è‡ªåŠ¨å®‰æ’
- ğŸ”” äº‹ä»¶æé†’

### âœ… Gmailï¼ˆé…ç½®åï¼‰
- ğŸ“§ é‚®ä»¶æ™ºèƒ½åˆ†ç±»å’Œæ€»ç»“
- ğŸ’¬ è‡ªåŠ¨é‚®ä»¶å›å¤
- ğŸ” é‚®ä»¶æœç´¢å’Œåˆ†æ

---

## ğŸ“š å‚è€ƒèµ„æº

- **Notion APIæ–‡æ¡£**: https://developers.notion.com/
- **Google Calendar APIæ–‡æ¡£**: https://developers.google.com/calendar/api
- **Gmail APIæ–‡æ¡£**: https://developers.google.com/gmail/api
- **OAuth2æˆæƒæµç¨‹**: https://oauth.net/2/

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… å…ˆé…ç½® **Notion**ï¼ˆæœ€ç®€å•ï¼‰
2. âœ… å†é…ç½® **GoogleæœåŠ¡**ï¼ˆç¨å¤æ‚ä½†ä¸€æ¬¡é…ç½®ä¸¤ä¸ªæœåŠ¡ï¼‰
3. âœ… æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
4. âœ… æ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´æœåŠ¡é…ç½®

é…ç½®å®Œæˆåï¼Œä½ çš„Agentèƒ½åŠ›å°†æå‡ **+150%**ï¼ğŸ‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-24
**ä½œè€…**: AI Assistant

