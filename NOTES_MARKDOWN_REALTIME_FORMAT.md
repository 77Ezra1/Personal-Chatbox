# 笔记编辑器 Markdown 实时格式化功能

## ✅ 修复完成

已修复笔记编辑器的 Markdown 实时格式化功能，现在支持像 Typora 和飞书文档那样的即时格式化体验。

---

## 🎯 功能说明

### 实时格式化触发方式

#### 1️⃣ **有序列表** - 输入 `1.` + 空格
```
输入: 1. [空格]
效果: 自动转换为有序列表
显示: • 带编号的列表项
```

#### 2️⃣ **无序列表** - 输入 `-` 或 `*` 或 `+` + 空格
```
输入: - [空格]
效果: 自动转换为无序列表
显示: • 带圆点的列表项
```

#### 3️⃣ **标题** - 输入 `#` + 空格
```
输入: # [空格]        → H1 一级标题
输入: ## [空格]       → H2 二级标题
输入: ### [空格]      → H3 三级标题
输入: #### [空格]     → H4 四级标题
输入: ##### [空格]    → H5 五级标题
输入: ###### [空格]   → H6 六级标题
```

#### 4️⃣ **引用** - 输入 `>` + 空格
```
输入: > [空格]
效果: 自动转换为引用块
显示: 带左侧边框的引用样式
```

#### 5️⃣ **代码块** - 输入 ` ``` ` + 回车
```
输入: ``` [回车]
效果: 创建代码块
显示: 深色背景的代码区域
```

---

## 🔧 技术实现

### 修改文件
- **文件**: `src/components/notes/MarkdownLikeEditor.jsx`
- **改动**:
  1. 引入 `wrappingInputRule` API（第 16 行）
  2. 修复列表的 InputRule 实现（第 24-50 行）

### 关键代码

```javascript
// 使用 wrappingInputRule 而非 textblockTypeInputRule
wrappingInputRule({
  find: /^\s*([-*+])\s$/,
  type: this.editor.schema.nodes.bulletList,
})

wrappingInputRule({
  find: /^(\d+)\.\s$/,
  type: this.editor.schema.nodes.orderedList,
})
```

### 为什么之前不工作？

**问题原因**:
- 原代码使用 `textblockTypeInputRule` 处理列表
- 这个 API 只能转换文本块（如标题、引用），不能创建包裹结构（如列表）
- 列表需要嵌套结构：`bulletList → listItem → paragraph`

**解决方案**:
- 使用 `wrappingInputRule` API
- 它会正确创建列表的嵌套结构
- TipTap 会自动处理列表项的添加和缩进

---

## 📖 使用示例

### 创建有序列表

1. 在编辑器中输入 `1.` 然后按**空格键**
2. 自动转换为有序列表格式
3. 输入第一项内容
4. 按**回车**自动创建下一个列表项（编号递增）
5. 按**回车**两次退出列表

**效果演示**:
```
输入: 1. 第一项
      ↓ 按回车
      2. 第二项
      ↓ 按回车
      3. 第三项
```

### 创建无序列表

1. 在编辑器中输入 `-` 然后按**空格键**
2. 自动转换为无序列表格式
3. 输入第一项内容
4. 按**回车**自动创建下一个列表项
5. 按**回车**两次退出列表

**效果演示**:
```
输入: - 第一项
      ↓ 按回车
      - 第二项
      ↓ 按回车
      - 第三项
```

### 嵌套列表

1. 创建一个列表项
2. 按**Tab**键增加缩进（创建子列表）
3. 按**Shift+Tab**减少缩进（返回上级）

**效果演示**:
```
- 主列表项 1
  - 子列表项 1.1
  - 子列表项 1.2
- 主列表项 2
```

---

## ✨ 其他 Markdown 快捷键

### 文本格式化（需选中文本）
- **粗体**: `Ctrl/Cmd + B` 或使用工具栏 `B` 按钮
- **斜体**: `Ctrl/Cmd + I` 或使用工具栏 `I` 按钮
- **代码**: 用反引号包裹 `` `code` ``

### 快捷操作
- **保存**: `Ctrl/Cmd + S`
- **取消**: `Esc`
- **斜杠命令**: 输入 `/` 打开命令菜单

---

## 🧪 测试步骤

### 1. 启动开发服务器
```bash
./start-dev.sh
# 或
npm run dev
```

### 2. 访问笔记页面
```
http://localhost:5173
→ 进入 Notes 页面
→ 点击 "New Note" 或编辑现有笔记
```

### 3. 测试实时格式化

**测试有序列表**:
1. 输入 `1.` 然后按空格
2. 应该立即看到列表项符号
3. 输入文字，按回车继续添加

**测试无序列表**:
1. 输入 `-` 然后按空格
2. 应该立即看到圆点符号
3. 输入文字，按回车继续添加

**测试标题**:
1. 输入 `##` 然后按空格
2. 文字应该立即变成二级标题样式

**测试引用**:
1. 输入 `>` 然后按空格
2. 应该看到左侧边框的引用样式

---

## 🎨 视觉效果

### 有序列表样式
```
1. 第一项 ← 自动编号
2. 第二项 ← 编号递增
3. 第三项
```

### 无序列表样式
```
• 列表项 1 ← 圆点符号
• 列表项 2
• 列表项 3
```

### 引用样式
```
┃ 这是一段引用文字
┃ 带有左侧边框和背景色
```

---

## 🐛 已修复的问题

1. ✅ 空格键无法输入
2. ✅ 列表 Markdown 语法不生效
3. ✅ 输入 `1.` + 空格无法创建有序列表
4. ✅ 输入 `-` + 空格无法创建无序列表

---

## 📝 注意事项

1. **空格必须紧跟在标记后面**:
   - ✅ `1. ` (有空格)
   - ❌ `1.` (无空格)

2. **列表需要在新行开始**:
   - ✅ 光标在行首输入 `-` + 空格
   - ❌ 在文字中间输入 `-` + 空格

3. **退出列表**:
   - 在空列表项按**回车**两次即可退出

4. **标题只在段落开始时生效**:
   - ✅ 新段落输入 `##` + 空格
   - ❌ 段落中间输入 `##` + 空格

---

## 🚀 后续优化建议

- [ ] 添加更多 Markdown 语法支持（表格、任务列表等）
- [ ] 支持 `[ ]` 创建复选框列表
- [ ] 支持 `---` 创建分隔线
- [ ] 优化列表嵌套的视觉反馈
- [ ] 添加快捷键提示面板

---

**生成时间**: 2025-10-19
**相关文件**:
- [MarkdownLikeEditor.jsx](src/components/notes/MarkdownLikeEditor.jsx)
- [NoteEditor.jsx](src/components/notes/NoteEditor.jsx)
