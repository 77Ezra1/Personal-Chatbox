# MCP服务配置步骤

## 🚀 第1步：配置Notion（5分钟）⭐⭐⭐⭐⭐

### 操作指南

#### 1. 创建Notion Integration

1. **打开浏览器**，访问：
   ```
   https://www.notion.so/my-integrations
   ```

2. **点击** `+ New integration` 按钮

3. **填写信息**：
   - **Name**: `Personal Chatbox Agent`（或任意名称）
   - **Associated workspace**: 选择你的工作区
   - **Type**: Internal Integration
   - **Capabilities**: 勾选以下权限
     - ✅ Read content
     - ✅ Update content
     - ✅ Insert content
     - ✅ Read user information (可选)

4. **点击** `Submit` 创建

5. **复制Token**：
   - 创建成功后会显示 `Internal Integration Token`
   - 格式类似：`secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - **复制整个Token**（包括 `secret_` 前缀）

---

#### 2. 分享Notion页面给Integration

⚠️ **重要**：必须将页面分享给Integration，否则无法访问！

1. 打开你的任意Notion页面（或创建一个新页面）
2. 点击右上角的 `Share` 按钮
3. 在 `Invite` 搜索框中输入 `Personal Chatbox Agent`（你的Integration名称）
4. 点击 `Invite` 添加

---

#### 3. 配置到项目

**方法A：使用环境变量（推荐）**

在终端运行以下命令：

```bash
# 进入项目目录
cd /Users/ezra/Personal-Chatbox

# 将你的Token添加到.env文件（替换下面的YOUR_TOKEN_HERE）
echo 'NOTION_API_KEY=secret_YOUR_TOKEN_HERE' >> .env

# 查看.env文件确认
cat .env | grep NOTION
```

**替换说明**：
- 将 `secret_YOUR_TOKEN_HERE` 替换为你复制的实际Token
- 确保包含 `secret_` 前缀

---

#### 4. 启用Notion服务

编辑 `server/config.cjs`，找到 `notion` 配置，修改：

```javascript
notion: {
  id: 'notion',
  name: 'Notion知识管理',
  enabled: true,  // 改为 true
  autoLoad: true,  // 改为 true
  // ... 其他配置保持不变
}
```

或者运行我提供的自动化脚本（稍后）

---

#### 5. 重启服务器

```bash
# 停止旧服务
pkill -f "node.*server/index.cjs"

# 等待2秒
sleep 2

# 启动新服务
nohup node server/index.cjs > server-restart.log 2>&1 &

# 查看日志确认Notion服务启动
sleep 5
tail -100 server-restart.log | grep -i notion
```

---

#### 6. 测试Notion功能

在前端对话框中输入：

```
"在Notion中创建一个测试页面，标题是'AI助手测试笔记'，内容是'这是我的第一个AI创建的笔记'"
```

或者：

```
"列出我Notion中的所有页面"
```

---

## ✅ 成功标志

如果看到以下日志，说明Notion服务启动成功：

```
[MCP Manager] notion 初始化成功
[MCP Manager] notion 启动成功, 工具数量: XX
```

---

## ❌ 常见问题

### Q1: 提示 "unauthorized" 或 "access denied"

**原因**: 没有将页面分享给Integration

**解决**:
1. 打开你的Notion页面
2. 点击 `Share`
3. 搜索并添加你的Integration
4. 重试

---

### Q2: Token格式错误

**检查**:
- Token必须以 `secret_` 开头
- Token长度应该很长（50+字符）
- 不要有多余的空格或引号

**正确格式**:
```bash
NOTION_API_KEY=secret_abc123def456...（很长的字符串）
```

---

### Q3: 服务启动失败

**查看日志**:
```bash
tail -200 server-restart.log | grep -A10 -B10 notion
```

**常见原因**:
- NPM包下载失败 → 检查网络
- 配置格式错误 → 检查.env文件

---

## 🚀 下一步

配置完Notion后，可以继续配置：

### 第2步：配置Google Calendar & Gmail（15分钟）

详细步骤查看：`API密钥获取指南.md`

---

**当前状态**: 准备配置Notion
**预计时间**: 5分钟
**难度**: ⭐ 非常简单

---

准备好了吗？按照上面的步骤开始吧！🎉

