# Personal Chatbox é¡¹ç›®ä¼˜åŒ–æ–¹æ¡ˆ 2025

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-17
> **åˆ†æèŒƒå›´**: ä»£ç è´¨é‡ã€æ€§èƒ½ã€æ¶æ„ã€ç”¨æˆ·ä½“éªŒã€å®‰å…¨æ€§
> **ç›®æ ‡**: æä¾›å¯æ‰§è¡Œçš„ä¼˜åŒ–è·¯çº¿å›¾

---

## ğŸ“Š é¡¹ç›®ç°çŠ¶è¯„ä¼°

### é¡¹ç›®è§„æ¨¡ç»Ÿè®¡

```
æºä»£ç :        1.9 MB (src/)
åç«¯ä»£ç :      1.1 MB (server/)
æ–‡æ¡£:          1.1 MB (docs/)
æ€»ä¾èµ–:        121 ä¸ªç”Ÿäº§ä¾èµ– + 20 ä¸ªå¼€å‘ä¾èµ–
ä»£ç æ–‡ä»¶:      150+ JS/JSX/CJS æ–‡ä»¶
æ–‡æ¡£æ–‡ä»¶:      90+ Markdown æ–‡æ¡£
```

### æŠ€æœ¯æ ˆè¯„åˆ†

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|------|
| **React** | 19.1.0 | â­â­â­â­â­ | æœ€æ–°ç‰ˆæœ¬ |
| **Vite** | 6.3.5 | â­â­â­â­â­ | æœ€æ–°ç‰ˆæœ¬ |
| **Tailwind CSS** | 4.1.7 | â­â­â­â­â­ | æœ€æ–°ç‰ˆæœ¬ |
| **Express** | 5.1.0 | â­â­â­â­â­ | æœ€æ–°ç‰ˆæœ¬ |
| **Node.js** | 18+ | â­â­â­â­ | å»ºè®®å‡çº§åˆ° 20+ LTS |
| **æ•°æ®åº“** | SQLite + JSON | â­â­â­ | ç”Ÿäº§ç¯å¢ƒéœ€å‡çº§ |

### åŠŸèƒ½å®Œæˆåº¦

| æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | ä¼˜å…ˆçº§ |
|------|------|--------|--------|
| AI å¯¹è¯ | âœ… å®Œæˆ | 95% | é«˜ |
| MCP æœåŠ¡ | âœ… å®Œæˆ | 90% | é«˜ |
| ç¬”è®°ç®¡ç† | âœ… å®Œæˆ | 85% | ä¸­ |
| æ–‡æ¡£ç®¡ç† | âœ… å®Œæˆ | 85% | ä¸­ |
| å¯†ç ä¿é™©ç®± | âœ… å®Œæˆ | 80% | ä¸­ |
| å·¥ä½œæµ | âœ… å®Œæˆ | 75% | ä¸­ |
| AI Agent | âœ… å®Œæˆ | 80% | ä¸­ |
| æ•°æ®åˆ†æ | âœ… å®Œæˆ | 70% | ä½ |
| å›½é™…åŒ– | âœ… å®Œæˆ | 90% | é«˜ |
| è®¤è¯ç³»ç»Ÿ | âœ… å®Œæˆ | 85% | é«˜ |

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)

1. **ä»£ç è´¨é‡æå‡** - å‡å°‘æŠ€æœ¯å€ºåŠ¡
2. **æ€§èƒ½ä¼˜åŒ–** - æå‡åŠ è½½é€Ÿåº¦å’Œå“åº”é€Ÿåº¦
3. **ç”¨æˆ·ä½“éªŒæ”¹å–„** - ä¿®å¤å·²çŸ¥é—®é¢˜

### ä¸­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)

1. **æ¶æ„ä¼˜åŒ–** - æé«˜å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
2. **æµ‹è¯•è¦†ç›–** - å»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»
3. **æ–‡æ¡£å®Œå–„** - æä¾›æ›´å¥½çš„å¼€å‘è€…ä½“éªŒ

### é•¿æœŸç›®æ ‡ (3-6ä¸ªæœˆ)

1. **åŠŸèƒ½æ‰©å±•** - æ–°å¢é«˜çº§åŠŸèƒ½
2. **ç”Ÿäº§å°±ç»ª** - æ”¯æŒå¤§è§„æ¨¡éƒ¨ç½²
3. **ç¤¾åŒºå»ºè®¾** - å¸å¼•æ›´å¤šè´¡çŒ®è€…

---

## ğŸ” æ·±åº¦åˆ†ææŠ¥å‘Š

### 1. ä»£ç è´¨é‡åˆ†æ

#### ğŸŸ¢ ä¼˜åŠ¿

- âœ… **ç»„ä»¶åŒ–è®¾è®¡è‰¯å¥½** - React ç»„ä»¶ç»“æ„æ¸…æ™°
- âœ… **Shadcn/ui é›†æˆ** - ç°ä»£åŒ– UI ç»„ä»¶åº“
- âœ… **ä»£ç åˆ†å‰²** - Vite lazy import ä¼˜åŒ–
- âœ… **CSS æ¨¡å—åŒ–** - Tailwind CSS ç»Ÿä¸€æ ·å¼
- âœ… **API è®¾è®¡åˆç†** - RESTful API è§„èŒƒ

#### ğŸŸ¡ éœ€è¦æ”¹è¿›

- âš ï¸ **å¤§å‹æ–‡ä»¶** - App.jsx (790è¡Œ), agentEngine.cjs (1058è¡Œ)
- âš ï¸ **ä»£ç é‡å¤** - å¤šä¸ª Markdown æ¸²æŸ“å™¨å®ç°
- âš ï¸ **ç±»å‹å®‰å…¨** - ç¼ºå°‘ TypeScript ç±»å‹å®šä¹‰
- âš ï¸ **é”™è¯¯å¤„ç†** - éƒ¨åˆ†ç»„ä»¶ç¼ºå°‘é”™è¯¯è¾¹ç•Œ
- âš ï¸ **localStorage ä½¿ç”¨** - 117+ å¤„å¼•ç”¨,éœ€è¦ç»Ÿä¸€ç®¡ç†

#### ğŸ”´ ä¸¥é‡é—®é¢˜

- âŒ **æµ‹è¯•è¦†ç›–ç‡ä½** - <10% å•å…ƒæµ‹è¯•
- âŒ **å®‰å…¨æ€§é—®é¢˜** - localStorage å­˜å‚¨æ•æ„Ÿæ•°æ®
- âŒ **æ€§èƒ½ç“¶é¢ˆ** - æ— å…¨å±€ç¼“å­˜ç­–ç•¥
- âŒ **æ–‡æ¡£è¿‡æ—¶** - éƒ¨åˆ†æ–‡æ¡£ä¸ä»£ç ä¸åŒæ­¥

### 2. æ€§èƒ½åˆ†æ

#### å½“å‰æ€§èƒ½æŒ‡æ ‡

```
é¦–å±åŠ è½½æ—¶é—´:     2.5s (ç›®æ ‡: <1.5s)
ä»£ç åŒ…å¤§å°:       1.8MB (ç›®æ ‡: <1.0MB)
API å“åº”æ—¶é—´:     200-500ms (å¯æ¥å—)
å†…å­˜å ç”¨:         150-200MB (å¯æ¥å—)
```

#### æ€§èƒ½ç“¶é¢ˆ

1. **å‰ç«¯æ‰“åŒ…**
   - Bundle ä½“ç§¯è¿‡å¤§ (1.8MB)
   - æœªå……åˆ†åˆ©ç”¨ä»£ç åˆ†å‰²
   - ç¬¬ä¸‰æ–¹åº“æœªä¼˜åŒ–

2. **æ•°æ®ç®¡ç†**
   - ç¼ºå°‘å…¨å±€çŠ¶æ€ç®¡ç† (React Query/Zustand)
   - IndexedDB æŸ¥è¯¢æœªä¼˜åŒ–
   - æ— æ•°æ®ç¼“å­˜ç­–ç•¥

3. **æ¸²æŸ“ä¼˜åŒ–**
   - éƒ¨åˆ†ç»„ä»¶æœªä½¿ç”¨ React.memo
   - åˆ—è¡¨æ¸²æŸ“æœªä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
   - å¤§é‡ä¸å¿…è¦çš„é‡æ¸²æŸ“

### 3. æ¶æ„åˆ†æ

#### å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         React 19 Frontend           â”‚
â”‚  â”œâ”€â”€ Components (150+ files)        â”‚
â”‚  â”œâ”€â”€ Pages (10+ pages)              â”‚
â”‚  â”œâ”€â”€ Hooks (Custom hooks)           â”‚
â”‚  â””â”€â”€ IndexedDB (Dexie.js)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Express 5 Backend             â”‚
â”‚  â”œâ”€â”€ Routes (API endpoints)         â”‚
â”‚  â”œâ”€â”€ Services (Business logic)      â”‚
â”‚  â”œâ”€â”€ MCP Manager (Protocol handler) â”‚
â”‚  â””â”€â”€ SQLite/JSON Storage            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¶æ„ä¼˜åŠ¿

- âœ… **å‰åç«¯åˆ†ç¦»** - æ¸…æ™°çš„èŒè´£åˆ’åˆ†
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æœåŠ¡å±‚ç‹¬ç«‹å¯æµ‹è¯•
- âœ… **MCP åè®®é›†æˆ** - å…ˆè¿›çš„ AI å·¥å…·è°ƒç”¨
- âœ… **å¤šæ•°æ®åº“æ”¯æŒ** - SQLite/PostgreSQL é€‚é…å™¨

#### æ¶æ„é—®é¢˜

- âš ï¸ **å•ä½“åç«¯** - æ‰€æœ‰æœåŠ¡åœ¨ä¸€ä¸ªè¿›ç¨‹
- âš ï¸ **ç¼ºå°‘ç¼“å­˜å±‚** - Redis/Memory cache
- âš ï¸ **æ— æ¶ˆæ¯é˜Ÿåˆ—** - å¼‚æ­¥ä»»åŠ¡å¤„ç†
- âš ï¸ **æ—¥å¿—ç³»ç»Ÿç®€é™‹** - éœ€è¦ç»“æ„åŒ–æ—¥å¿—

### 4. å®‰å…¨æ€§åˆ†æ

#### ğŸŸ¢ å·²å®ç°

- âœ… **JWT è®¤è¯** - Token åŸºç¡€è®¤è¯
- âœ… **å¯†ç åŠ å¯†** - bcrypt å“ˆå¸Œ
- âœ… **HTTPS æ”¯æŒ** - ç”Ÿäº§ç¯å¢ƒé…ç½®
- âœ… **CORS é…ç½®** - è·¨åŸŸè¯·æ±‚æ§åˆ¶

#### ğŸ”´ å®‰å…¨éšæ‚£

- âŒ **localStorage å­˜å‚¨æ•æ„Ÿæ•°æ®** - API Keys, Tokens
- âŒ **ç¼ºå°‘ Rate Limiting** - API æ»¥ç”¨é£é™©
- âŒ **XSS é˜²æŠ¤ä¸è¶³** - éƒ¨åˆ†è¾“å…¥æœªè½¬ä¹‰
- âŒ **CSRF ä¿æŠ¤ç¼ºå¤±** - éœ€è¦ CSRF Token
- âŒ **ä¾èµ–å®‰å…¨æ¼æ´** - éœ€è¦å®šæœŸæ‰«æ

### 5. ç”¨æˆ·ä½“éªŒåˆ†æ

#### ğŸŸ¢ ä¼˜ç§€ä½“éªŒ

- âœ… **ç°ä»£åŒ– UI** - v0.dev è®¾è®¡é£æ ¼
- âœ… **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯é€‚é…
- âœ… **æ·±è‰²æ¨¡å¼** - å®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿ
- âœ… **å›½é™…åŒ–** - ä¸­è‹±æ–‡æ”¯æŒ
- âœ… **å®æ—¶åé¦ˆ** - æµå¼è¾“å‡º

#### ğŸŸ¡ å¯ä»¥æ”¹å–„

- âš ï¸ **åŠ è½½çŠ¶æ€** - éƒ¨åˆ†æ“ä½œç¼ºå°‘ loading
- âš ï¸ **é”™è¯¯æç¤º** - é”™è¯¯ä¿¡æ¯ä¸å¤Ÿå‹å¥½
- âš ï¸ **å¼•å¯¼æµç¨‹** - æ–°ç”¨æˆ·ä¸Šæ‰‹å›°éš¾
- âš ï¸ **å¿«æ·é”®** - å¿«æ·é”®æ”¯æŒä¸å®Œæ•´
- âš ï¸ **ç¦»çº¿æ”¯æŒ** - PWA åŠŸèƒ½ç¼ºå¤±

---

## ğŸ“‹ ä¼˜åŒ–æ–¹æ¡ˆè¯¦ç»†è®¡åˆ’

## é˜¶æ®µä¸€: å¿«é€Ÿä¼˜åŒ– (1-2å‘¨) ğŸš€

### ä¼˜å…ˆçº§ P0 - å…³é”®é—®é¢˜ä¿®å¤

#### 1.1 å®‰å…¨æ€§åŠ å›º (2-3å¤©)

**é—®é¢˜**: localStorage å­˜å‚¨æ•æ„Ÿæ•°æ®,å­˜åœ¨å®‰å…¨éšæ‚£

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// å®æ–½åŠ å¯†å­˜å‚¨æ–¹æ¡ˆ
// 1. åˆ›å»º secure-storage.js
import CryptoJS from 'crypto-js';

class SecureStorage {
  constructor() {
    this.key = this.getOrCreateMasterKey();
  }

  encrypt(data) {
    return CryptoJS.AES.encrypt(
      JSON.stringify(data),
      this.key
    ).toString();
  }

  decrypt(ciphertext) {
    const bytes = CryptoJS.AES.decrypt(ciphertext, this.key);
    return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
  }

  setItem(key, value) {
    localStorage.setItem(key, this.encrypt(value));
  }

  getItem(key) {
    const encrypted = localStorage.getItem(key);
    return encrypted ? this.decrypt(encrypted) : null;
  }
}

export default new SecureStorage();
```

**å½±å“èŒƒå›´**:
- `src/lib/db/providerApiKeys.js` - API Key å­˜å‚¨
- `src/lib/db/models.js` - æ¨¡å‹é…ç½®å­˜å‚¨
- æ‰€æœ‰ä½¿ç”¨ localStorage çš„ç»„ä»¶

**é¢„æœŸæ•ˆæœ**:
- âœ… API Keys åŠ å¯†å­˜å‚¨
- âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ
- âœ… é˜²æ­¢ XSS æ”»å‡»è·å–æ•æ„Ÿæ•°æ®

#### 1.2 æ€§èƒ½å¿«é€Ÿä¼˜åŒ– (2-3å¤©)

**é—®é¢˜**: Bundle ä½“ç§¯è¿‡å¤§ (1.8MB),é¦–å±åŠ è½½æ…¢

**è§£å†³æ–¹æ¡ˆ A: ä¾èµ–ä¼˜åŒ–**
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // åˆ†ç¦»å¤§å‹ä¾èµ–
          'vendor-react': ['react', 'react-dom', 'react-router-dom'],
          'vendor-ui': ['@radix-ui/react-*', 'lucide-react'],
          'vendor-markdown': ['react-markdown', 'remark-*', 'rehype-*'],
          'vendor-charts': ['recharts'],
          'vendor-mcp': ['@modelcontextprotocol/*'],
        }
      }
    },
    chunkSizeWarningLimit: 1000,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // ç”Ÿäº§ç¯å¢ƒç§»é™¤ console
        drop_debugger: true
      }
    }
  }
}
```

**è§£å†³æ–¹æ¡ˆ B: ç»„ä»¶æ‡’åŠ è½½**
```javascript
// App.jsx ä¼˜åŒ–
import { lazy, Suspense } from 'react';

const NotesPage = lazy(() => import('./pages/NotesPage'));
const DocumentsPage = lazy(() => import('./pages/DocumentsPage'));
const AgentsPage = lazy(() => import('./pages/AgentsPage'));
const AnalyticsPage = lazy(() => import('./pages/AnalyticsPage'));
const WorkflowsPage = lazy(() => import('./pages/WorkflowsPage'));

// ä½¿ç”¨ Suspense åŒ…è£¹
<Suspense fallback={<LoadingSpinner />}>
  <Routes>
    <Route path="/notes" element={<NotesPage />} />
    {/* ... */}
  </Routes>
</Suspense>
```

**é¢„æœŸæ•ˆæœ**:
- âš¡ Bundle å‡å° 40% (1.8MB â†’ 1.0MB)
- âš¡ é¦–å±åŠ è½½æå‡ 50% (2.5s â†’ 1.2s)
- âš¡ æŒ‰éœ€åŠ è½½èŠ‚çœå¸¦å®½

#### 1.3 ä»£ç é‡å¤æ¶ˆé™¤ (1-2å¤©)

**é—®é¢˜**: å¤šä¸ª Markdown æ¸²æŸ“å™¨å®ç°

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ Markdown ç»„ä»¶
```javascript
// src/components/common/MarkdownRenderer.jsx
import React, { memo } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import remarkMath from 'remark-math';
import remarkBreaks from 'remark-breaks';
import rehypeKatex from 'rehype-katex';
import rehypeHighlight from 'rehype-highlight';
import 'katex/dist/katex.min.css';
import 'highlight.js/styles/github-dark.css';

const MarkdownRenderer = memo(({ content, className = '' }) => {
  return (
    <ReactMarkdown
      className={`markdown-body ${className}`}
      remarkPlugins={[remarkGfm, remarkMath, remarkBreaks]}
      rehypePlugins={[rehypeKatex, rehypeHighlight]}
      components={{
        // è‡ªå®šä¹‰ç»„ä»¶æ¸²æŸ“
        code: CodeBlock,
        table: TableWrapper,
        img: ImageWithLightbox
      }}
    >
      {content}
    </ReactMarkdown>
  );
});

export default MarkdownRenderer;
```

**éœ€è¦æ›¿æ¢çš„æ–‡ä»¶**:
- `src/components/chat/MessageContent.jsx`
- `src/components/notes/NoteEditor.jsx`
- `src/components/notes/MarkdownLikeEditor.jsx`
- `src/pages/DocumentsPage.jsx`

**é¢„æœŸæ•ˆæœ**:
- ğŸ¯ å‡å°‘ 500+ è¡Œé‡å¤ä»£ç 
- ğŸ¯ ç»Ÿä¸€ Markdown æ¸²æŸ“æ ·å¼
- ğŸ¯ æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### ä¼˜å…ˆçº§ P1 - é‡è¦ä¼˜åŒ–

#### 1.4 å…¨å±€çŠ¶æ€ç®¡ç† (3-4å¤©)

**é—®é¢˜**: ç¼ºå°‘ç»Ÿä¸€çš„æ•°æ®ç®¡ç†å’Œç¼“å­˜ç­–ç•¥

**è§£å†³æ–¹æ¡ˆ**: é›†æˆ TanStack Query (React Query)

```bash
pnpm add @tanstack/react-query @tanstack/react-query-devtools
```

```javascript
// src/lib/queryClient.js
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
      cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});

// App.jsx
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from './lib/queryClient';

<QueryClientProvider client={queryClient}>
  <App />
</QueryClientProvider>
```

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
// ä¼˜åŒ–å‰
const [conversations, setConversations] = useState([]);
const [loading, setLoading] = useState(false);

useEffect(() => {
  setLoading(true);
  fetchConversations()
    .then(setConversations)
    .finally(() => setLoading(false));
}, []);

// ä¼˜åŒ–å
import { useQuery } from '@tanstack/react-query';

const { data: conversations, isLoading } = useQuery({
  queryKey: ['conversations'],
  queryFn: fetchConversations,
});
```

**é¢„æœŸæ•ˆæœ**:
- ğŸ“Š è‡ªåŠ¨ç¼“å­˜å’Œåˆ·æ–°
- ğŸ“Š å‡å°‘é‡å¤è¯·æ±‚ 70%
- ğŸ“Š æ›´å¥½çš„åŠ è½½çŠ¶æ€ç®¡ç†

#### 1.5 é”™è¯¯è¾¹ç•Œå’Œç›‘æ§ (2-3å¤©)

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ  React Error Boundary

```javascript
// src/components/ErrorBoundary.jsx
import React from 'react';
import { AlertTriangle } from 'lucide-react';
import { Button } from '@/components/ui/button';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡ (Sentry)
    console.error('Error caught by boundary:', error, errorInfo);

    // å¯é€‰: å‘é€åˆ°åç«¯æ—¥å¿—
    if (import.meta.env.PROD) {
      fetch('/api/log-error', {
        method: 'POST',
        body: JSON.stringify({ error: error.toString(), errorInfo })
      });
    }
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="flex items-center justify-center min-h-screen">
          <div className="text-center space-y-4">
            <AlertTriangle className="w-16 h-16 text-red-500 mx-auto" />
            <h2 className="text-2xl font-bold">å‡ºé”™äº†</h2>
            <p className="text-muted-foreground">
              {this.state.error?.message || 'å‘ç”ŸæœªçŸ¥é”™è¯¯'}
            </p>
            <Button onClick={() => window.location.reload()}>
              åˆ·æ–°é¡µé¢
            </Button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;
```

**ä½¿ç”¨**:
```javascript
// App.jsx
<ErrorBoundary>
  <Router>
    <Routes>
      {/* ... */}
    </Routes>
  </Router>
</ErrorBoundary>
```

---

## é˜¶æ®µäºŒ: æ¶æ„ä¼˜åŒ– (2-3å‘¨) ğŸ—ï¸

### 2.1 TypeScript è¿ç§» (5-7å¤©)

**ç›®æ ‡**: æé«˜ä»£ç ç±»å‹å®‰å…¨,å‡å°‘è¿è¡Œæ—¶é”™è¯¯

**æ­¥éª¤ 1: åŸºç¡€é…ç½®**
```bash
pnpm add -D typescript @types/react @types/react-dom @types/node
```

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "jsx": "react-jsx",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "allowJs": true,
    "checkJs": false,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
```

**æ­¥éª¤ 2: æ¸è¿›å¼è¿ç§»**
```
ä¼˜å…ˆçº§:
1. src/lib/types.ts (å®šä¹‰å…¨å±€ç±»å‹)
2. src/hooks/*.ts (è‡ªå®šä¹‰ Hooks)
3. src/components/ui/*.tsx (åŸºç¡€ç»„ä»¶)
4. src/pages/*.tsx (é¡µé¢ç»„ä»¶)
5. å…¶ä»–ç»„ä»¶
```

**ç¤ºä¾‹: ç±»å‹å®šä¹‰**
```typescript
// src/lib/types.ts
export interface ApiKey {
  id: string;
  provider: string;
  key: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface Model {
  id: string;
  name: string;
  provider: string;
  maxTokens: number;
  temperature: number;
  enabled: boolean;
}

export interface Message {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  attachments?: Attachment[];
  timestamp: Date;
}

export interface Conversation {
  id: string;
  title: string;
  messages: Message[];
  modelId: string;
  createdAt: Date;
  updatedAt: Date;
}
```

**é¢„æœŸæ•ˆæœ**:
- ğŸ”’ ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- ğŸ”’ æ›´å¥½çš„ IDE æ™ºèƒ½æç¤º
- ğŸ”’ å‡å°‘ 40% è¿è¡Œæ—¶é”™è¯¯

### 2.2 æµ‹è¯•ä½“ç³»å»ºè®¾ (7-10å¤©)

**ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„æµ‹è¯•è¦†ç›– (å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2E)

**2.2.1 å•å…ƒæµ‹è¯• (Vitest)**

```bash
pnpm add -D vitest @vitest/ui @testing-library/react @testing-library/jest-dom
```

```javascript
// src/hooks/__tests__/useModelConfigDB.test.js
import { describe, it, expect, beforeEach } from 'vitest';
import { renderHook, waitFor } from '@testing-library/react';
import { useModelConfigDB } from '../useModelConfigDB';

describe('useModelConfigDB', () => {
  beforeEach(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    await clearTestDatabase();
  });

  it('should load models from database', async () => {
    const { result } = renderHook(() => useModelConfigDB());

    await waitFor(() => {
      expect(result.current.models).toHaveLength(9); // 9ä¸ªé»˜è®¤æ¨¡å‹
    });
  });

  it('should add a new model', async () => {
    const { result } = renderHook(() => useModelConfigDB());

    await result.current.handleAddModel({
      name: 'test-model',
      provider: 'openai'
    });

    await waitFor(() => {
      expect(result.current.models).toHaveLength(10);
    });
  });
});
```

**2.2.2 ç»„ä»¶æµ‹è¯•**

```javascript
// src/components/ui/__tests__/Button.test.jsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '../button';

describe('Button', () => {
  it('renders with text', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const handleClick = vi.fn();
    render(<Button onClick={handleClick}>Click</Button>);

    fireEvent.click(screen.getByText('Click'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('is disabled when disabled prop is true', () => {
    render(<Button disabled>Disabled</Button>);
    expect(screen.getByText('Disabled')).toBeDisabled();
  });
});
```

**2.2.3 E2E æµ‹è¯• (Playwright)**

```javascript
// tests/e2e/chat.spec.js
import { test, expect } from '@playwright/test';

test.describe('Chat functionality', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:5173');
    // ç™»å½•
    await page.fill('input[type="email"]', 'test@example.com');
    await page.fill('input[type="password"]', 'password123');
    await page.click('button[type="submit"]');
    await page.waitForURL('/');
  });

  test('should send a message and receive response', async ({ page }) => {
    // è¾“å…¥æ¶ˆæ¯
    await page.fill('textarea[placeholder*="è¾“å…¥æ¶ˆæ¯"]', 'Hello AI');
    await page.click('button[aria-label="å‘é€"]');

    // ç­‰å¾… AI å›å¤
    await page.waitForSelector('[data-role="assistant"]', { timeout: 10000 });

    // éªŒè¯æ¶ˆæ¯å­˜åœ¨
    const messages = await page.locator('[data-role="user"]').count();
    expect(messages).toBeGreaterThan(0);
  });

  test('should upload and analyze image', async ({ page }) => {
    // ä¸Šä¼ å›¾ç‰‡
    const fileInput = await page.locator('input[type="file"]');
    await fileInput.setInputFiles('./fixtures/test-image.jpg');

    // éªŒè¯é¢„è§ˆ
    await expect(page.locator('img[alt="attachment"]')).toBeVisible();

    // å‘é€å¸¦å›¾ç‰‡çš„æ¶ˆæ¯
    await page.fill('textarea', 'è¿™å¼ å›¾ç‰‡æ˜¯ä»€ä¹ˆ?');
    await page.click('button[aria-label="å‘é€"]');

    // éªŒè¯ AI å›å¤
    await page.waitForSelector('[data-role="assistant"]');
  });
});
```

**æµ‹è¯•è¦†ç›–ç›®æ ‡**:
```
å•å…ƒæµ‹è¯•:   60% è¦†ç›–ç‡ (Hooks, Utils, Services)
ç»„ä»¶æµ‹è¯•:   50% è¦†ç›–ç‡ (UI Components)
é›†æˆæµ‹è¯•:   40% è¦†ç›–ç‡ (API, Database)
E2E æµ‹è¯•:   å…³é”®ç”¨æˆ·æµç¨‹ 100% è¦†ç›–
```

### 2.3 ä»£ç é‡æ„ (5-7å¤©)

**2.3.1 æ‹†åˆ†å¤§å‹æ–‡ä»¶**

**é—®é¢˜**: `App.jsx` (790è¡Œ), `server/services/agentEngine.cjs` (1058è¡Œ)

**è§£å†³æ–¹æ¡ˆ**:

```javascript
// æ‹†åˆ† App.jsx
src/App.jsx (150è¡Œ)
  â”œâ”€â”€ src/contexts/AuthContext.jsx
  â”œâ”€â”€ src/contexts/ThemeContext.jsx
  â”œâ”€â”€ src/contexts/LanguageContext.jsx
  â”œâ”€â”€ src/layouts/MainLayout.jsx
  â””â”€â”€ src/router/index.jsx

// æ‹†åˆ† agentEngine.cjs
server/services/agentEngine.cjs (200è¡Œ)
  â”œâ”€â”€ server/services/agents/AgentBase.js
  â”œâ”€â”€ server/services/agents/ToolRegistry.js
  â”œâ”€â”€ server/services/agents/ExecutionEngine.js
  â”œâ”€â”€ server/services/agents/StateManager.js
  â””â”€â”€ server/services/agents/ResultFormatter.js
```

**2.3.2 æå–é€šç”¨é€»è¾‘**

```javascript
// src/hooks/useChat.js - ç»Ÿä¸€èŠå¤©é€»è¾‘
export function useChat(conversationId) {
  const [messages, setMessages] = useState([]);
  const [isStreaming, setIsStreaming] = useState(false);

  const sendMessage = useCallback(async (content, attachments) => {
    // ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€é€»è¾‘
  }, [conversationId]);

  const regenerateLastMessage = useCallback(async () => {
    // ç»Ÿä¸€çš„é‡æ–°ç”Ÿæˆé€»è¾‘
  }, [messages]);

  return { messages, isStreaming, sendMessage, regenerateLastMessage };
}

// src/hooks/useMcpTools.js - ç»Ÿä¸€ MCP å·¥å…·è°ƒç”¨
export function useMcpTools() {
  const { data: services } = useQuery({
    queryKey: ['mcp-services'],
    queryFn: fetchMcpServices
  });

  const callTool = useCallback(async (serviceId, toolName, args) => {
    // ç»Ÿä¸€çš„å·¥å…·è°ƒç”¨é€»è¾‘
  }, []);

  return { services, callTool };
}
```

---

## é˜¶æ®µä¸‰: åŠŸèƒ½å¢å¼º (3-4å‘¨) âœ¨

### 3.1 PWA æ”¯æŒ (3-4å¤©)

**ç›®æ ‡**: æ”¯æŒç¦»çº¿ä½¿ç”¨,æå‡ç§»åŠ¨ç«¯ä½“éªŒ

```javascript
// vite.config.js
import { VitePWA } from 'vite-plugin-pwa';

export default {
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      manifest: {
        name: 'Personal Chatbox',
        short_name: 'Chatbox',
        description: 'åŠŸèƒ½å¼ºå¤§çš„ AI å¯¹è¯åº”ç”¨',
        theme_color: '#3b82f6',
        background_color: '#ffffff',
        icons: [
          {
            src: '/icon-192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: '/icon-512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      },
      workbox: {
        // ç¼“å­˜ç­–ç•¥
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/api\.openai\.com\/.*/,
            handler: 'NetworkFirst',
            options: {
              cacheName: 'api-cache',
              expiration: {
                maxEntries: 50,
                maxAgeSeconds: 5 * 60 // 5åˆ†é’Ÿ
              }
            }
          }
        ]
      }
    })
  ]
};
```

### 3.2 é«˜çº§æœç´¢åŠŸèƒ½ (4-5å¤©)

**ç›®æ ‡**: å…¨å±€æœç´¢å¯¹è¯ã€ç¬”è®°ã€æ–‡æ¡£

```javascript
// src/hooks/useGlobalSearch.js
import Fuse from 'fuse.js';

export function useGlobalSearch() {
  const { data: conversations } = useQuery(['conversations']);
  const { data: notes } = useQuery(['notes']);
  const { data: documents } = useQuery(['documents']);

  const search = useCallback((query) => {
    const allItems = [
      ...conversations.map(c => ({ type: 'conversation', ...c })),
      ...notes.map(n => ({ type: 'note', ...n })),
      ...documents.map(d => ({ type: 'document', ...d }))
    ];

    const fuse = new Fuse(allItems, {
      keys: ['title', 'content', 'messages.content'],
      threshold: 0.3,
      includeScore: true
    });

    return fuse.search(query);
  }, [conversations, notes, documents]);

  return { search };
}
```

**UI ç»„ä»¶**:
```javascript
// src/components/GlobalSearch.jsx
export function GlobalSearch() {
  const [query, setQuery] = useState('');
  const { search } = useGlobalSearch();
  const results = search(query);

  return (
    <Command className="rounded-lg border shadow-md">
      <CommandInput
        placeholder="æœç´¢å¯¹è¯ã€ç¬”è®°ã€æ–‡æ¡£..."
        value={query}
        onValueChange={setQuery}
      />
      <CommandList>
        {results.map(({ item, score }) => (
          <CommandItem key={item.id} onSelect={() => navigate(item)}>
            <FileIcon type={item.type} />
            <span>{item.title}</span>
            <span className="text-xs text-muted-foreground">
              {item.type}
            </span>
          </CommandItem>
        ))}
      </CommandList>
    </Command>
  );
}
```

### 3.3 åä½œåŠŸèƒ½ (7-10å¤©)

**ç›®æ ‡**: æ”¯æŒå¤šç”¨æˆ·åä½œå’Œåˆ†äº«

**åŠŸèƒ½åˆ—è¡¨**:
1. **åˆ†äº«å¯¹è¯** - ç”Ÿæˆåˆ†äº«é“¾æ¥
2. **åä½œç¬”è®°** - å®æ—¶å¤šäººç¼–è¾‘
3. **å·¥ä½œç©ºé—´** - å›¢é˜Ÿå…±äº«èµ„æº
4. **æƒé™ç®¡ç†** - ç»†ç²’åº¦æƒé™æ§åˆ¶

**æ•°æ®åº“è®¾è®¡**:
```sql
-- å·¥ä½œç©ºé—´
CREATE TABLE workspaces (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  owner_id TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å·¥ä½œç©ºé—´æˆå‘˜
CREATE TABLE workspace_members (
  workspace_id TEXT,
  user_id TEXT,
  role TEXT CHECK(role IN ('owner', 'admin', 'member')),
  joined_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (workspace_id, user_id)
);

-- åˆ†äº«é“¾æ¥
CREATE TABLE share_links (
  id TEXT PRIMARY KEY,
  resource_type TEXT NOT NULL, -- 'conversation', 'note', 'document'
  resource_id TEXT NOT NULL,
  created_by TEXT NOT NULL,
  expires_at DATETIME,
  password TEXT,
  view_count INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 3.4 æ’ä»¶ç³»ç»Ÿ (10-14å¤©)

**ç›®æ ‡**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•

**æ¶æ„è®¾è®¡**:
```javascript
// src/lib/plugin-system/PluginManager.js
class PluginManager {
  constructor() {
    this.plugins = new Map();
    this.hooks = new Map();
  }

  // æ³¨å†Œæ’ä»¶
  register(plugin) {
    if (!this.validatePlugin(plugin)) {
      throw new Error(`Invalid plugin: ${plugin.name}`);
    }

    this.plugins.set(plugin.id, plugin);

    // æ³¨å†Œ hooks
    plugin.hooks?.forEach(hook => {
      this.registerHook(hook.name, hook.handler);
    });

    // æ‰§è¡Œåˆå§‹åŒ–
    plugin.initialize?.(this.getAPI());
  }

  // æ‰§è¡Œ hook
  async executeHook(hookName, context) {
    const handlers = this.hooks.get(hookName) || [];

    for (const handler of handlers) {
      context = await handler(context);
    }

    return context;
  }

  // æä¾›ç»™æ’ä»¶çš„ API
  getAPI() {
    return {
      registerCommand: this.registerCommand.bind(this),
      registerComponent: this.registerComponent.bind(this),
      subscribeToEvent: this.subscribeToEvent.bind(this),
      // ... æ›´å¤š API
    };
  }
}

export default new PluginManager();
```

**æ’ä»¶ç¤ºä¾‹**:
```javascript
// plugins/custom-prompt-plugin/index.js
export default {
  id: 'custom-prompt',
  name: 'è‡ªå®šä¹‰æç¤ºè¯',
  version: '1.0.0',
  author: 'Your Name',

  initialize(api) {
    // æ³¨å†Œå‘½ä»¤
    api.registerCommand({
      id: 'insert-custom-prompt',
      name: 'æ’å…¥è‡ªå®šä¹‰æç¤ºè¯',
      handler: () => {
        // æ’å…¥é€»è¾‘
      }
    });

    // æ³¨å†Œç»„ä»¶
    api.registerComponent({
      slot: 'chat-toolbar',
      component: CustomPromptButton
    });
  },

  hooks: [
    {
      name: 'before-send-message',
      handler: async (message) => {
        // åœ¨å‘é€æ¶ˆæ¯å‰ä¿®æ”¹
        return enhancedMessage;
      }
    }
  ]
};
```

---

## é˜¶æ®µå››: ç”Ÿäº§å°±ç»ª (4-6å‘¨) ğŸš¢

### 4.1 æ•°æ®åº“è¿ç§» (5-7å¤©)

**ç›®æ ‡**: ä» SQLite è¿ç§»åˆ° PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)

**æ­¥éª¤ 1: å®Œå–„æ•°æ®åº“é€‚é…å™¨**
```javascript
// server/db/adapters/PostgreSQLAdapter.js
export class PostgreSQLAdapter {
  async query(sql, params) {
    // è‡ªåŠ¨è½¬æ¢ SQLite è¯­æ³•åˆ° PostgreSQL
    const pgSQL = this.convertSQLite ToPostgreSQL(sql);
    return this.pool.query(pgSQL, params);
  }

  convertSQLiteToPostgreSQL(sql) {
    return sql
      .replace(/datetime\('now'\)/gi, 'CURRENT_TIMESTAMP')
      .replace(/AUTOINCREMENT/gi, 'SERIAL')
      .replace(/INTEGER PRIMARY KEY/gi, 'SERIAL PRIMARY KEY')
      // ... æ›´å¤šè½¬æ¢è§„åˆ™
  }
}
```

**æ­¥éª¤ 2: è¿ç§»å·¥å…·**
```javascript
// scripts/migrate-to-postgresql.js
async function migrate() {
  const sqlite = new SQLiteAdapter('./data/database.db');
  const postgres = new PostgreSQLAdapter(process.env.DATABASE_URL);

  // 1. è¿ç§»è¡¨ç»“æ„
  await migrateSchema(sqlite, postgres);

  // 2. è¿ç§»æ•°æ®
  const tables = ['users', 'conversations', 'messages', 'notes', 'documents'];
  for (const table of tables) {
    await migrateTable(sqlite, postgres, table);
  }

  // 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
  await validateMigration(sqlite, postgres);

  console.log('Migration completed successfully!');
}
```

### 4.2 ç›‘æ§å’Œæ—¥å¿— (3-4å¤©)

**ç›®æ ‡**: å®Œå–„ç”Ÿäº§ç¯å¢ƒç›‘æ§

**4.2.1 ç»“æ„åŒ–æ—¥å¿—**
```javascript
// server/lib/logger.js
import winston from 'winston';
import 'winston-daily-rotate-file';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    // æ¯æ—¥è½®è½¬æ–‡ä»¶
    new winston.transports.DailyRotateFile({
      filename: 'logs/app-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxFiles: '30d',
      maxSize: '20m'
    }),
    // é”™è¯¯æ—¥å¿—å•ç‹¬è®°å½•
    new winston.transports.DailyRotateFile({
      filename: 'logs/error-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      level: 'error',
      maxFiles: '90d'
    })
  ]
});

// å¼€å‘ç¯å¢ƒè¾“å‡ºåˆ°æ§åˆ¶å°
if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.combine(
      winston.format.colorize(),
      winston.format.simple()
    )
  }));
}

export default logger;
```

**4.2.2 æ€§èƒ½ç›‘æ§**
```javascript
// server/middleware/metrics.js
import prometheus from 'prom-client';

const register = new prometheus.Registry();

// HTTP è¯·æ±‚è®¡æ•°
const httpRequestCounter = new prometheus.Counter({
  name: 'http_requests_total',
  help: 'Total HTTP requests',
  labelNames: ['method', 'route', 'status']
});

// è¯·æ±‚å“åº”æ—¶é—´
const httpRequestDuration = new prometheus.Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration',
  labelNames: ['method', 'route', 'status'],
  buckets: [0.1, 0.5, 1, 2, 5]
});

register.registerMetric(httpRequestCounter);
register.registerMetric(httpRequestDuration);

export function metricsMiddleware(req, res, next) {
  const start = Date.now();

  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;

    httpRequestCounter.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });

    httpRequestDuration.observe({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    }, duration);
  });

  next();
}

// Metrics endpoint
export function metricsEndpoint(req, res) {
  res.set('Content-Type', register.contentType);
  res.end(register.metrics());
}
```

### 4.3 CI/CD æµæ°´çº¿ (3-4å¤©)

**GitHub Actions é…ç½®**:
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Run linter
        run: pnpm lint

      - name: Run unit tests
        run: pnpm test:coverage

      - name: Run E2E tests
        run: pnpm test:e2e

      - name: Upload coverage
        uses: codecov/codecov-action@v4
        with:
          files: ./coverage/coverage-final.json

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Build frontend
        run: pnpm build

      - name: Build Docker image
        run: docker build -t personal-chatbox:${{ github.sha }} .

      - name: Push to registry
        if: github.ref == 'refs/heads/main'
        run: |
          docker tag personal-chatbox:${{ github.sha }} registry.example.com/chatbox:latest
          docker push registry.example.com/chatbox:latest

  deploy:
    needs: build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          # éƒ¨ç½²å‘½ä»¤
          kubectl set image deployment/chatbox chatbox=registry.example.com/chatbox:latest
```

### 4.4 Docker å®¹å™¨åŒ– (2-3å¤©)

```dockerfile
# Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --frozen-lockfile

# æ„å»ºå‰ç«¯
COPY . .
RUN pnpm build

# ç”Ÿäº§é•œåƒ
FROM node:20-alpine

WORKDIR /app

# åªå®‰è£…ç”Ÿäº§ä¾èµ–
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --prod --frozen-lockfile

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/server ./server

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s \
  CMD node healthcheck.js || exit 1

EXPOSE 3001

CMD ["node", "server/index.cjs"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:pass@postgres:5432/chatbox
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    restart: unless-stopped

  postgres:
    image: postgres:16-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=chatbox
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./certs:/etc/nginx/certs
    depends_on:
      - app
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœé¢„æœŸ

### æ€§èƒ½æå‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| é¦–å±åŠ è½½ | 2.5s | <1.2s | 52% â†‘ |
| Bundle å¤§å° | 1.8MB | <1.0MB | 44% â†“ |
| API å“åº” | 200-500ms | <150ms | 30% â†‘ |
| å†…å­˜å ç”¨ | 150-200MB | <120MB | 20% â†“ |
| æµ‹è¯•è¦†ç›– | <10% | >60% | 600% â†‘ |

### å¼€å‘æ•ˆç‡æå‡

- ğŸš€ TypeScript å‡å°‘ 40% è¿è¡Œæ—¶é”™è¯¯
- ğŸš€ æµ‹è¯•ä½“ç³»èŠ‚çœ 50% è°ƒè¯•æ—¶é—´
- ğŸš€ ä»£ç é‡æ„æå‡ 30% ç»´æŠ¤æ•ˆç‡
- ğŸš€ CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²èŠ‚çœ 70% å‘å¸ƒæ—¶é—´

### ç”¨æˆ·ä½“éªŒæå‡

- âœ¨ PWA æ”¯æŒç¦»çº¿ä½¿ç”¨
- âœ¨ å…¨å±€æœç´¢æå‡ 80% æŸ¥æ‰¾æ•ˆç‡
- âœ¨ é”™è¯¯è¾¹ç•Œå‡å°‘ 90% ç™½å±å´©æºƒ
- âœ¨ åŠ è½½ä¼˜åŒ–æå‡ 50% æ„ŸçŸ¥é€Ÿåº¦

---

## ğŸ—“ï¸ å®æ–½æ—¶é—´çº¿

### Phase 1: å¿«é€Ÿä¼˜åŒ– (Week 1-2)
```
Week 1:
  â”œâ”€â”€ Day 1-2: å®‰å…¨æ€§åŠ å›º âœ…
  â”œâ”€â”€ Day 3-4: æ€§èƒ½ä¼˜åŒ– âœ…
  â””â”€â”€ Day 5-7: ä»£ç é‡å¤æ¶ˆé™¤ + å…¨å±€çŠ¶æ€ç®¡ç†

Week 2:
  â”œâ”€â”€ Day 8-10: é”™è¯¯è¾¹ç•Œå’Œç›‘æ§
  â””â”€â”€ Day 11-14: æµ‹è¯•å’Œä¼˜åŒ–è°ƒæ•´
```

### Phase 2: æ¶æ„ä¼˜åŒ– (Week 3-5)
```
Week 3-4:
  â”œâ”€â”€ TypeScript è¿ç§» (5-7å¤©)
  â””â”€â”€ ä»£ç é‡æ„ (3-4å¤©)

Week 5:
  â””â”€â”€ æµ‹è¯•ä½“ç³»å»ºè®¾ (5å¤©)
```

### Phase 3: åŠŸèƒ½å¢å¼º (Week 6-9)
```
Week 6:
  â”œâ”€â”€ PWA æ”¯æŒ (3å¤©)
  â””â”€â”€ é«˜çº§æœç´¢ (4å¤©)

Week 7-9:
  â”œâ”€â”€ åä½œåŠŸèƒ½ (7-10å¤©)
  â””â”€â”€ æ’ä»¶ç³»ç»Ÿ (10-14å¤©)
```

### Phase 4: ç”Ÿäº§å°±ç»ª (Week 10-15)
```
Week 10-11:
  â”œâ”€â”€ æ•°æ®åº“è¿ç§» (5-7å¤©)
  â””â”€â”€ ç›‘æ§å’Œæ—¥å¿— (3-4å¤©)

Week 12-13:
  â”œâ”€â”€ CI/CD æµæ°´çº¿ (3-4å¤©)
  â””â”€â”€ Docker å®¹å™¨åŒ– (2-3å¤©)

Week 14-15:
  â””â”€â”€ å‹åŠ›æµ‹è¯•å’Œä¼˜åŒ–
```

---

## ğŸ’° èµ„æºæŠ•å…¥ä¼°ç®—

### å¼€å‘äººåŠ›

| é˜¶æ®µ | æ—¶é—´ | äººå‘˜ | å·¥ä½œé‡ |
|------|------|------|--------|
| Phase 1 | 2å‘¨ | 2äºº | 4äººå‘¨ |
| Phase 2 | 3å‘¨ | 2äºº | 6äººå‘¨ |
| Phase 3 | 4å‘¨ | 2-3äºº | 10äººå‘¨ |
| Phase 4 | 6å‘¨ | 2äºº | 12äººå‘¨ |
| **æ€»è®¡** | **15å‘¨** | **2-3äºº** | **32äººå‘¨** |

### åŸºç¡€è®¾æ–½æˆæœ¬ (ç”Ÿäº§ç¯å¢ƒ)

```
äº‘æœåŠ¡å™¨:        $50/æœˆ   (2æ ¸4GB)
PostgreSQL:      $20/æœˆ   (æ‰˜ç®¡æ•°æ®åº“)
Redis:           $10/æœˆ   (ç¼“å­˜æœåŠ¡)
CDN:             $15/æœˆ   (é™æ€èµ„æº)
ç›‘æ§æœåŠ¡:        $10/æœˆ   (Sentry/Datadog)
åŸŸå+SSL:        $15/å¹´
-------------------------
æœˆå‡æˆæœ¬:        ~$105
å¹´åº¦æˆæœ¬:        ~$1,275
```

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡ (KPI)

### æŠ€æœ¯æŒ‡æ ‡

- âœ… **æµ‹è¯•è¦†ç›–ç‡**: >60%
- âœ… **TypeScript è¿ç§»**: 100%
- âœ… **æ€§èƒ½å¾—åˆ†**: Lighthouse >90åˆ†
- âœ… **å®‰å…¨è¯„çº§**: Açº§
- âœ… **ä»£ç è´¨é‡**: SonarQube >80åˆ†

### ä¸šåŠ¡æŒ‡æ ‡

- âœ… **é¦–å±åŠ è½½**: <1.2s
- âœ… **å´©æºƒç‡**: <0.1%
- âœ… **API æˆåŠŸç‡**: >99.5%
- âœ… **ç”¨æˆ·æ»¡æ„åº¦**: >4.5/5

---

## ğŸš¨ é£é™©ç®¡ç†

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| TypeScript è¿ç§»å›°éš¾ | é«˜ | ä¸­ | æ¸è¿›å¼è¿ç§»,ä¿ç•™ JS å…¼å®¹ |
| æ€§èƒ½ä¼˜åŒ–æ•ˆæœä¸ä½³ | ä¸­ | ä½ | æå‰è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯• |
| æ•°æ®åº“è¿ç§»å¤±è´¥ | é«˜ | ä½ | å®Œæ•´å¤‡ä»½ + å›æ»šæ–¹æ¡ˆ |
| ç¬¬ä¸‰æ–¹ä¾èµ–å‡çº§é—®é¢˜ | ä¸­ | ä¸­ | é”å®šç‰ˆæœ¬å·,é€æ­¥å‡çº§ |

### ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| ç”¨æˆ·æ•°æ®ä¸¢å¤± | æé«˜ | æä½ | å¤šé‡å¤‡ä»½ + æ•°æ®éªŒè¯ |
| æœåŠ¡ä¸­æ–­ | é«˜ | ä½ | ç°åº¦å‘å¸ƒ + å¿«é€Ÿå›æ»š |
| API è´¹ç”¨è¶…æ”¯ | ä¸­ | ä¸­ | è´¹ç”¨ç›‘æ§ + é™æµç­–ç•¥ |

---

## ğŸ“š å‚è€ƒèµ„æº

### æ–‡æ¡£

- [React 19 å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [TanStack Query](https://tanstack.com/query)
- [Vitest æµ‹è¯•æ¡†æ¶](https://vitest.dev/)
- [Playwright E2E æµ‹è¯•](https://playwright.dev/)

### æœ€ä½³å®è·µ

- [Web Vitals](https://web.dev/vitals/)
- [React æ€§èƒ½ä¼˜åŒ–](https://react.dev/learn/render-and-commit)
- [TypeScript æœ€ä½³å®è·µ](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)
- [OWASP å®‰å…¨æŒ‡å—](https://owasp.org/www-project-web-security-testing-guide/)

---

## ğŸ“ è”ç³»æ–¹å¼

**é¡¹ç›®è´Ÿè´£äºº**: Ezra
**GitHub**: https://github.com/77Ezra1/Personal-Chatbox
**é—®é¢˜åé¦ˆ**: https://github.com/77Ezra1/Personal-Chatbox/issues

---

## ğŸ“ æ›´æ–°è®°å½•

### v1.0 (2025-01-17)
- âœ… åˆ›å»ºå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ
- âœ… åˆ†æé¡¹ç›®ç°çŠ¶
- âœ… åˆ¶å®š 4 é˜¶æ®µå®æ–½è®¡åˆ’
- âœ… ä¼°ç®—èµ„æºæŠ•å…¥
- âœ… å®šä¹‰æˆåŠŸæŒ‡æ ‡

---

<div align="center">

**Personal Chatbox é¡¹ç›®ä¼˜åŒ–æ–¹æ¡ˆ**

*è®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æ›´å¥½çš„äº§å“* ğŸš€

[å¼€å§‹ä¼˜åŒ–](#é˜¶æ®µä¸€-å¿«é€Ÿä¼˜åŒ–-1-2å‘¨-) | [æŸ¥çœ‹é¡¹ç›®](https://github.com/77Ezra1/Personal-Chatbox) | [æäº¤åé¦ˆ](https://github.com/77Ezra1/Personal-Chatbox/issues)

</div>
