# å‘é€æ¶ˆæ¯æ— ååº”é—®é¢˜ - è§£å†³æ–¹æ¡ˆ

## âœ… å·²å®Œæˆ

1. **API key å·²è¿ç§»åˆ°æ•°æ®åº“** âœ…
   - æ‰€æœ‰ç”¨æˆ·çš„ DeepSeek API key å·²ä¿å­˜åˆ° `user_configs` è¡¨
   - API key: `sk-03db8009812649359e2f83cc738861aa`

## ğŸ” é—®é¢˜è¯Šæ–­

### å¯èƒ½çš„åŸå› 

1. **å‰ç«¯æ²¡æœ‰ç™»å½•æˆ– token è¿‡æœŸ**
2. **å‰ç«¯æ²¡æœ‰æ­£ç¡®å‘é€è¯·æ±‚**
3. **åç«¯è®¤è¯å¤±è´¥**
4. **JavaScript é”™è¯¯**

## ğŸ› ï¸ è§£å†³æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥æ˜¯å¦ç™»å½•

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¿è¡Œï¼š

```javascript
console.log('Token:', localStorage.getItem('token'));
```

å¦‚æœæ˜¾ç¤º `null` æˆ– `undefined`ï¼Œè¯´æ˜æ²¡æœ‰ç™»å½•ã€‚

**è§£å†³æ–¹æ³•**: å…ˆç™»å½•æˆ–æ³¨å†Œè´¦å·

### æ­¥éª¤2: æ£€æŸ¥ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
3. æ¸…ç©ºç°æœ‰è¯·æ±‚
4. åœ¨è¾“å…¥æ¡†è¾“å…¥ "ä½ å¥½" å¹¶å‘é€
5. æŸ¥çœ‹æ˜¯å¦æœ‰ `/api/chat` è¯·æ±‚

**æœŸæœ›ç»“æœ**:
- åº”è¯¥çœ‹åˆ° `POST /api/chat` è¯·æ±‚
- çŠ¶æ€ç åº”è¯¥æ˜¯ `200 OK`

**å¦‚æœæ²¡æœ‰è¯·æ±‚**:
- å‰ç«¯ä»£ç æœ‰é—®é¢˜ï¼Œå¯èƒ½ JavaScript æŠ¥é”™
- æ£€æŸ¥ Console æ ‡ç­¾æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯

**å¦‚æœè¯·æ±‚å¤±è´¥**:
- `401 Unauthorized`: æ²¡æœ‰ç™»å½•æˆ– token æ— æ•ˆ
- `400 Bad Request`: è¯·æ±‚æ ¼å¼é”™è¯¯
- `500 Internal Server Error`: åç«¯é”™è¯¯

### æ­¥éª¤3: æ£€æŸ¥ Console é”™è¯¯

åœ¨æµè§ˆå™¨ Console æ ‡ç­¾æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ï¼ˆçº¢è‰²æ–‡å­—ï¼‰

å¸¸è§é”™è¯¯:
- `localStorage.getItem is not a function`: token è¯»å–å¤±è´¥
- `fetch is not defined`: ç½‘ç»œè¯·æ±‚å¤±è´¥
- `Cannot read property of undefined`: æ•°æ®æ ¼å¼é—®é¢˜

### æ­¥éª¤4: æ‰‹åŠ¨æµ‹è¯•åç«¯ API

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ‰‹åŠ¨å‘é€è¯·æ±‚æµ‹è¯•ï¼š

```javascript
// 1. è·å– token
const token = localStorage.getItem('token');
console.log('Token:', token ? 'å·²æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');

// 2. å‘é€æµ‹è¯•è¯·æ±‚
fetch('/api/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    messages: [{role: 'user', content: 'ä½ å¥½'}],
    model: 'deepseek-chat',
    stream: false
  })
})
.then(response => {
  console.log('çŠ¶æ€ç :', response.status);
  return response.json();
})
.then(data => console.log('å“åº”:', data))
.catch(error => console.error('é”™è¯¯:', error));
```

### æ­¥éª¤5: é‡æ–°ç™»å½•

å¦‚æœ token æ— æ•ˆæˆ–è¿‡æœŸï¼š

1. ç‚¹å‡»é€€å‡ºç™»å½•ï¼ˆå¦‚æœæœ‰ï¼‰
2. é‡æ–°ç™»å½•
3. å†æ¬¡å°è¯•å‘é€æ¶ˆæ¯

æˆ–è€…åœ¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
// æ¸…é™¤æ—§ token
localStorage.removeItem('token');

// ç„¶åé‡æ–°ç™»å½•
```

## ğŸ”§ å¿«é€Ÿä¿®å¤

### æ–¹æ³•1: åˆ·æ–°é¡µé¢å¹¶é‡æ–°ç™»å½•

1. æŒ‰ `Cmd + Shift + R` (Mac) æˆ– `Ctrl + Shift + R` (Windows) ç¡¬åˆ·æ–°
2. é‡æ–°ç™»å½•
3. å‘é€æµ‹è¯•æ¶ˆæ¯

### æ–¹æ³•2: æ¸…é™¤æ‰€æœ‰æ•°æ®é‡æ–°å¼€å§‹

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
localStorage.clear();
sessionStorage.clear();
location.reload();
```

ç„¶åé‡æ–°æ³¨å†Œ/ç™»å½•

## ğŸ“Š è¯Šæ–­æ£€æŸ¥è¡¨

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
console.log('=== è¯Šæ–­ä¿¡æ¯ ===');
console.log('1. Token å­˜åœ¨:', !!localStorage.getItem('token'));
console.log('2. Token å€¼:', localStorage.getItem('token')?.substring(0, 20) + '...');
console.log('3. Model Config:', localStorage.getItem('modelConfig'));
console.log('4. å½“å‰ URL:', window.location.href);
console.log('5. ç”¨æˆ·ä¿¡æ¯:', localStorage.getItem('user'));
```

æŠŠè¾“å‡ºç»“æœå‘ç»™æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ è¿›ä¸€æ­¥è¯Šæ–­ã€‚

## ğŸ¯ æœ€å¯èƒ½çš„é—®é¢˜

æ ¹æ®ä½ çš„æˆªå›¾ï¼Œæˆ‘çœ‹åˆ°ï¼š

1. âœ… ç•Œé¢æ˜¾ç¤ºæ­£å¸¸
2. âœ… å¯ä»¥è¾“å…¥æ¶ˆæ¯
3. âŒ ç‚¹å‡»å‘é€æ²¡ååº”

**æœ€å¯èƒ½çš„åŸå› **:
- **æ²¡æœ‰ç™»å½•æˆ– token å¤±æ•ˆ**
- **å‰ç«¯è¯·æ±‚è¢«æ‹¦æˆª**
- **JavaScript æŠ¥é”™**

## ğŸ’¡ ç«‹å³å°è¯•

åœ¨æµè§ˆå™¨æ§åˆ¶å°ç²˜è´´å¹¶è¿è¡Œï¼š

```javascript
(async function diagnose() {
  console.log('=== å¼€å§‹è¯Šæ–­ ===');
  
  // 1. æ£€æŸ¥ token
  const token = localStorage.getItem('token');
  console.log('1. Token:', token ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
  
  if (!token) {
    console.log('âŒ æ²¡æœ‰ç™»å½•ï¼è¯·å…ˆç™»å½•');
    return;
  }
  
  // 2. æµ‹è¯•å‘é€æ¶ˆæ¯
  console.log('2. æµ‹è¯•å‘é€æ¶ˆæ¯...');
  try {
    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        messages: [{role: 'user', content: 'test'}],
        model: 'deepseek-chat',
        stream: false
      })
    });
    
    console.log('çŠ¶æ€ç :', response.status);
    
    if (response.ok) {
      const data = await response.json();
      console.log('âœ… æˆåŠŸï¼å“åº”:', data);
    } else {
      const error = await response.text();
      console.log('âŒ å¤±è´¥ï¼é”™è¯¯:', error);
    }
  } catch (error) {
    console.log('âŒ è¯·æ±‚å¼‚å¸¸:', error);
  }
  
  console.log('=== è¯Šæ–­å®Œæˆ ===');
})();
```

æŠŠç»“æœæˆªå›¾å‘ç»™æˆ‘ï¼

## ğŸ“ æ•°æ®åº“éªŒè¯

API key å·²ç»åœ¨æ•°æ®åº“ä¸­ï¼š

```sql
-- æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰ï¿½ï¿½ä¸ª API key
{"deepseek":"sk-03db8009812649359e2f83cc738861aa"}
```

æ‰€ä»¥åç«¯é…ç½®æ˜¯æ­£ç¡®çš„ï¼Œé—®é¢˜åœ¨å‰ç«¯ï¼
